<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GEMINI BUNDLER v11 (PRO)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/bs58@4.0.1/bundle/index.js"></script>
    <style>
        /* Cyberpunk Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #020617; }
        ::-webkit-scrollbar-thumb { background: #3730a3; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #4338ca; }
        
        .tab-active { border-bottom: 2px solid #6366f1; color: white; background: rgba(99, 102, 241, 0.1); }
        .tab-inactive { color: #64748b; }
        
        /* Smooth transitions for UI elements */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 font-mono text-sm h-[100dvh] flex flex-col overflow-hidden">

    <header class="bg-slate-900 border-b border-slate-800 p-2 shrink-0 gap-2">
        <div class="flex flex-col md:flex-row justify-between items-center gap-2">
            
            <div class="flex items-center justify-between w-full md:w-auto gap-4">
                <div class="flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse" id="statusLight"></div>
                    <h1 class="font-black text-sm tracking-tight text-white">GEMINI <span class="text-indigo-500">v11</span></h1>
                </div>
                <div class="bg-slate-950 border border-slate-700 rounded px-3 py-1 text-[11px] font-bold shadow-inner">
                    MAIN: <span id="headerBal" class="text-emerald-400">---</span> SOL
                </div>
            </div>
            
            <div class="flex items-center gap-2 w-full md:w-auto">
                <select id="rpcSelect" class="bg-slate-950 border border-slate-700 text-slate-400 text-[10px] p-1.5 rounded flex-1 focus:border-indigo-500 outline-none w-32 md:w-48">
                    <option value="auto">üöÄ AUTO-DETECT (Fastest)</option>
                    <option value="https://rpc.ankr.com/solana">Ankr Public</option>
                    <option value="https://api.mainnet-beta.solana.com">Solana Mainnet</option>
                </select>
                <div class="flex items-center gap-1 border border-slate-700 rounded px-2 py-1 bg-slate-900">
                    <input type="checkbox" id="corsToggle" checked class="accent-indigo-500 h-3 w-3">
                    <label for="corsToggle" class="text-[9px] text-slate-400 cursor-pointer select-none">PROXY</label>
                </div>
                <div id="rpcStatus" class="text-[9px] font-bold text-slate-600 uppercase w-16 text-center">WAITING</div>
            </div>
        </div>
    </header>

    <div class="flex-1 flex flex-col md:flex-row overflow-hidden">
        
        <div class="w-full md:w-[420px] flex flex-col border-r border-slate-800 bg-slate-900/50 overflow-y-auto p-3 gap-3">
            
            <div id="authContainer" class="relative group shrink-0">
                
                <div id="authInput" class="p-3 rounded-lg border border-indigo-500/20 bg-slate-900 shadow-lg">
                    <div class="absolute top-0 left-0 w-1 h-full bg-indigo-500 rounded-l"></div>
                    <h3 class="text-indigo-400 font-bold text-[10px] uppercase mb-1">Connect Main Authority</h3>
                    <input id="pkInput" type="password" placeholder="Paste Private Key (Base58)..." 
                        class="w-full bg-slate-950 border border-slate-800 text-slate-300 p-2 rounded text-[10px] focus:border-indigo-500 outline-none mb-2 placeholder:text-slate-600 font-mono">
                    <button onclick="connectWallet()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 rounded text-[10px] transition-all shadow-lg shadow-indigo-900/20">
                        CONNECT WALLET
                    </button>
                </div>

                <div id="authDisplay" class="hidden p-3 rounded-lg border border-emerald-500/20 bg-slate-900 shadow-lg fade-in">
                    <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500 rounded-l"></div>
                    <div class="flex justify-between items-center mb-2">
                        <h3 class="text-emerald-400 font-bold text-[10px] uppercase">Wallet Connected</h3>
                        <span class="text-[9px] text-slate-500 bg-slate-950 px-2 py-0.5 rounded border border-slate-800">ACTIVE</span>
                    </div>
                    <div class="flex items-center gap-2 bg-slate-950 p-2 rounded border border-slate-800 mb-2">
                        <div class="w-6 h-6 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-500"></div>
                        <div class="flex-1 min-w-0">
                            <div id="dispAddr" class="text-[10px] font-mono text-white truncate">...</div>
                        </div>
                    </div>
                    <button onclick="disconnectWallet()" class="w-full bg-slate-800 hover:bg-slate-700 text-slate-400 hover:text-white font-bold py-2 rounded text-[10px] transition-all border border-slate-700">
                        DISCONNECT
                    </button>
                </div>
            </div>

            <div class="flex border-b border-slate-800 shrink-0">
                <button onclick="switchTab('launch')" id="tab-launch" class="flex-1 py-2 text-[10px] font-bold tab-active">üöÄ LAUNCH</button>
                <button onclick="switchTab('snipe')" id="tab-snipe" class="flex-1 py-2 text-[10px] font-bold tab-inactive">üéØ SNIPE</button>
                <button onclick="switchTab('wallets')" id="tab-wallets" class="flex-1 py-2 text-[10px] font-bold tab-inactive">üëõ WALLETS</button>
            </div>

            <div id="view-launch" class="space-y-2">
                <div class="bg-slate-800/50 p-2 rounded border border-slate-700">
                    <div class="flex gap-2">
                        <input id="cloneCA" type="text" placeholder="Paste CA to Clone..." class="flex-1 bg-slate-950 border border-slate-700 p-1.5 rounded text-[10px]">
                        <button onclick="cloneCoin()" class="px-2 bg-slate-700 hover:bg-slate-600 rounded text-[10px] font-bold">CLONE</button>
                    </div>
                </div>

                <div class="space-y-2">
                    <div class="flex gap-2">
                        <input id="tName" type="text" placeholder="Token Name" class="w-1/2 bg-slate-950 border border-slate-700 p-2 rounded text-[10px] focus:border-indigo-500 outline-none">
                        <input id="tSymbol" type="text" placeholder="Ticker ($GEM)" class="w-1/2 bg-slate-950 border border-slate-700 p-2 rounded text-[10px] focus:border-indigo-500 outline-none">
                    </div>
                    <textarea id="tDesc" placeholder="Description..." class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-[10px] h-14 focus:border-indigo-500 outline-none"></textarea>
                    
                    <div class="grid grid-cols-3 gap-1">
                        <input id="tTwitter" type="text" placeholder="Twitter" class="bg-slate-950 border border-slate-700 p-1.5 rounded text-[10px]">
                        <input id="tTelegram" type="text" placeholder="Telegram" class="bg-slate-950 border border-slate-700 p-1.5 rounded text-[10px]">
                        <input id="tWebsite" type="text" placeholder="Website" class="bg-slate-950 border border-slate-700 p-1.5 rounded text-[10px]">
                    </div>

                    <input type="file" id="tImage" accept="image/*" class="w-full text-[10px] text-slate-500 file:mr-2 file:py-1 file:px-2 file:rounded file:border-0 file:text-[10px] file:bg-indigo-900 file:text-indigo-300 hover:file:bg-indigo-800 cursor-pointer bg-slate-900 rounded p-1"/>
                    
                    <div class="flex gap-2 pt-2 border-t border-slate-800 mt-2">
                        <div class="flex-1">
                            <label class="text-[9px] text-slate-500 uppercase font-bold">Dev Buy (Set 0 for Free)</label>
                            <input id="devBuy" type="number" value="0" step="0.1" class="w-full bg-slate-950 border border-slate-700 p-1.5 rounded text-[10px] text-emerald-400 font-bold">
                        </div>
                        <div class="flex-1">
                            <label class="text-[9px] text-slate-500 uppercase font-bold">Bundle Wallets (0 = None)</label>
                            <input id="bundleCount" type="number" value="0" class="w-full bg-slate-950 border border-slate-700 p-1.5 rounded text-[10px] text-blue-400 font-bold">
                        </div>
                    </div>
                </div>

                <button onclick="executeBundle()" class="w-full bg-gradient-to-r from-emerald-700 to-green-600 hover:from-emerald-600 hover:to-green-500 text-white font-black py-3 rounded shadow-lg text-xs mt-2 transition-all transform hover:scale-[1.01]">
                    DEPLOY / CREATE TOKEN
                </button>
            </div>

            <div id="view-snipe" class="space-y-2 hidden">
                <div class="bg-slate-800/50 p-3 rounded border border-slate-700 space-y-2">
                    <div>
                        <label class="text-[9px] text-slate-500 uppercase font-bold">Target Token Address</label>
                        <input id="snipeCA" type="text" placeholder="Paste CA..." class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-[10px] text-yellow-400 font-mono">
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label class="text-[9px] text-slate-500 uppercase font-bold">Buy Amount</label>
                            <input id="snipeAmt" type="number" value="0.1" step="0.01" class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-[10px]">
                        </div>
                        <div>
                            <label class="text-[9px] text-slate-500 uppercase font-bold">Slippage %</label>
                            <input id="snipeSlip" type="number" value="20" class="w-full bg-slate-950 border border-slate-700 p-2 rounded text-[10px]">
                        </div>
                    </div>
                </div>
                <button onclick="startSnipe()" class="w-full bg-yellow-600 hover:bg-yellow-500 text-white font-black py-3 rounded shadow-lg text-xs transition-all">
                    START MONITOR
                </button>
            </div>

            <div id="view-wallets" class="space-y-2 hidden">
                <div class="p-2 bg-slate-800/30 rounded border border-slate-700">
                    <h4 class="font-bold text-[10px] mb-1 text-slate-400">GENERATOR</h4>
                    <div class="flex gap-2">
                        <input id="genCount" type="number" value="10" class="w-16 bg-slate-950 border border-slate-700 p-1 rounded text-center text-[10px]">
                        <button onclick="generateWallets()" class="flex-1 bg-slate-700 hover:bg-slate-600 text-[10px] rounded font-bold">GENERATE</button>
                    </div>
                </div>
                
                <div class="p-2 bg-slate-800/30 rounded border border-slate-700">
                    <h4 class="font-bold text-[10px] mb-1 text-slate-400">FUNDER</h4>
                    <div class="flex gap-2 mb-1">
                        <input id="fundAmt" type="number" value="0.1" placeholder="SOL" class="flex-1 bg-slate-950 border border-slate-700 p-1.5 rounded text-[10px]">
                        <button onclick="fundAll()" class="bg-blue-600 hover:bg-blue-500 px-3 rounded text-[10px] font-bold">SEND SOL</button>
                    </div>
                </div>
            </div>

        </div>

        <div class="flex-1 flex flex-col bg-black min-h-0">
            
            <div class="h-1/2 border-b border-slate-800 p-3 overflow-y-auto">
                <div class="flex justify-between items-center mb-2 sticky top-0 bg-black py-1 border-b border-slate-900">
                    <h3 class="font-bold text-slate-400 text-[10px] uppercase">Generated Wallets</h3>
                    <div class="flex gap-2">
                         <button onclick="copyAllKeys()" class="text-[9px] bg-indigo-900/50 text-indigo-300 px-2 py-0.5 rounded border border-indigo-800 hover:bg-indigo-900">COPY ALL KEYS</button>
                         <button onclick="exportKeys()" class="text-[9px] text-slate-500 hover:text-slate-300 underline">CSV</button>
                    </div>
                </div>
                <div id="walletList" class="space-y-1 text-[9px] font-mono text-slate-500">
                    <div class="text-slate-700 italic p-2">Wallets generated in 'Wallets' tab will appear here.</div>
                </div>
            </div>

            <div class="h-1/2 p-3 bg-slate-950 flex flex-col min-h-0">
                <h3 class="font-bold text-slate-400 text-[10px] uppercase mb-1 border-b border-slate-800 pb-1 flex justify-between">
                    <span>System Logs</span>
                    <button onclick="document.getElementById('logs').innerHTML=''" class="text-[9px] text-slate-600">CLEAR</button>
                </h3>
                <div id="logs" class="flex-1 overflow-y-auto font-mono text-[10px] space-y-1 p-1 scroll-smooth">
                    <div class="text-slate-600">> System Ready. v11 Loaded.</div>
                </div>
                
                <div class="mt-2 pt-2 border-t border-slate-800 flex gap-2 shrink-0">
                    <button onclick="instaSell()" class="flex-1 bg-red-900/20 border border-red-800/50 text-red-400 py-2 rounded text-[10px] font-bold hover:bg-red-900/50 uppercase">
                        ‚ö†Ô∏è PANIC SELL ALL
                    </button>
                    <button onclick="returnSol()" class="flex-1 bg-slate-800 border border-slate-700 text-slate-400 py-2 rounded text-[10px] font-bold hover:bg-slate-700 uppercase">
                        REFUND SOL
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CORE VARIABLES ---
        let connection;
        let mainWallet;
        let subWallets = [];
        let isSniping = false;
        let balanceInterval;

        const PROXY_URL = "https://corsproxy.io/?";
        const PUBLIC_RPCS = [
            "https://rpc.ankr.com/solana",
            "https://api.mainnet-beta.solana.com", 
            "https://solana-mainnet.rpc.extrnode.com"
        ];

        // --- UTILS ---
        const log = (msg, type='info') => {
            const box = document.getElementById('logs');
            const div = document.createElement('div');
            const time = new Date().toLocaleTimeString().split(' ')[0];
            if(type === 'error') div.className = "text-red-400 font-bold bg-red-900/10 px-1 rounded";
            else if(type === 'success') div.className = "text-emerald-400 font-bold";
            else if(type === 'warn') div.className = "text-yellow-400";
            else div.className = "text-slate-400";
            div.innerHTML = `<span class="opacity-30 mr-2">[${time}]</span>${msg}`;
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        };

        const sleep = ms => new Promise(r => setTimeout(r, ms));

        function b58_dec(s) {
            const A = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
            let d = [0];
            for (let i = 0; i < s.length; i++) {
                let c = A.indexOf(s[i]);
                if (c === -1) continue;
                for (let j = 0; j < d.length; j++) d[j] *= 58;
                d[0] += c;
                let carry = 0;
                for (let j = 0; j < d.length; j++) {
                    d[j] += carry; carry = d[j] >> 8; d[j] &= 0xff;
                }
                while (carry) { d.push(carry & 0xff); carry >>= 8; }
            }
            for (let i = 0; i < s.length && s[i] === '1'; i++) d.push(0);
            return new Uint8Array(d.reverse());
        }

        function b58_enc(B) {
            const A = "123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";
            let d = [], s = "", i, j, c, n;
            for(i in B) { j = 0, c = B[i]; s += c || s.length ^ i ? "" : 1;
                while(j in d || c) { n = d[j]; n = n ? n * 256 + c : c; c = n / 58 | 0; d[j++] = n % 58; } }
            while(j--) s += A[d[j]]; return s;
        }

        function switchTab(tab) {
            ['launch', 'snipe', 'wallets'].forEach(t => {
                document.getElementById(`view-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).className = "flex-1 py-2 text-[10px] font-bold tab-inactive";
            });
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).className = "flex-1 py-2 text-[10px] font-bold tab-active";
        }

        // --- CONNECTION ---
        async function initConnection() {
            const mode = document.getElementById('rpcSelect').value;
            const useProxy = document.getElementById('corsToggle').checked;
            
            document.getElementById('statusLight').className = "w-2 h-2 rounded-full bg-yellow-500 animate-pulse";
            document.getElementById('rpcStatus').innerText = "CONNECTING";
            
            if(mode === 'auto') {
                log("Auto-detecting RPC...", "warn");
                for (let url of PUBLIC_RPCS) {
                    if(await tryConnect(url, false)) return;
                    if(useProxy && await tryConnect(url, true)) return;
                }
                failConnection();
            } else {
                if(await tryConnect(mode, useProxy)) return;
                if(!useProxy && await tryConnect(mode, true)) return;
                failConnection();
            }
        }

        async function tryConnect(url, useProxy) {
            const finalUrl = useProxy ? PROXY_URL + encodeURIComponent(url) : url;
            try {
                const tempConn = new solanaWeb3.Connection(finalUrl, 'confirmed');
                await tempConn.getVersion();
                connection = tempConn;
                
                document.getElementById('statusLight').className = "w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981]";
                document.getElementById('rpcStatus').innerText = "ONLINE";
                document.getElementById('rpcStatus').className = "text-[9px] font-bold text-emerald-500 uppercase w-16 text-center";
                log(`Connected via ${useProxy ? 'Proxy' : 'Direct'}`, "success");
                if(mainWallet) refreshBalance();
                return true;
            } catch(e) { return false; }
        }

        function failConnection() {
            document.getElementById('statusLight').className = "w-2 h-2 rounded-full bg-red-500 animate-pulse";
            document.getElementById('rpcStatus').innerText = "FAILED";
            document.getElementById('rpcStatus').className = "text-[9px] font-bold text-red-500 uppercase w-16 text-center";
            log("RPC Connection Failed.", "error");
        }

        // --- WALLET AUTH & BALANCE ---
        async function connectWallet() {
            if(!connection) await initConnection();
            
            let rawKey = document.getElementById('pkInput').value.trim();
            rawKey = rawKey.replace(/\s+/g, ''); // Remove spaces

            try {
                let secretKey;
                if (rawKey.startsWith('[') && rawKey.endsWith(']')) {
                    secretKey = Uint8Array.from(JSON.parse(rawKey));
                } else {
                    secretKey = b58_dec(rawKey);
                }
                
                if (secretKey.length !== 64) throw new Error("Key length mismatch");
                
                mainWallet = solanaWeb3.Keypair.fromSecretKey(secretKey);
                
                // UI TOGGLE
                document.getElementById('authInput').classList.add('hidden');
                document.getElementById('authDisplay').classList.remove('hidden');
                document.getElementById('dispAddr').innerText = mainWallet.publicKey.toBase58();
                
                log("Wallet Authenticated.", "success");
                refreshBalance();
                
                // Auto refresh balance
                if(balanceInterval) clearInterval(balanceInterval);
                balanceInterval = setInterval(refreshBalance, 10000);

            } catch(e) {
                log("Auth Failed: " + e.message, "error");
            }
        }

        function disconnectWallet() {
            mainWallet = null;
            document.getElementById('authInput').classList.remove('hidden');
            document.getElementById('authDisplay').classList.add('hidden');
            document.getElementById('pkInput').value = "";
            document.getElementById('headerBal').innerText = "---";
            if(balanceInterval) clearInterval(balanceInterval);
            log("Wallet Disconnected.", "warn");
        }

        async function refreshBalance() {
            if(!mainWallet || !connection) return;
            try {
                const bal = await connection.getBalance(mainWallet.publicKey);
                const sol = (bal / 1e9).toFixed(3);
                document.getElementById('headerBal').innerText = sol;
            } catch(e) { console.error(e); }
        }

        // --- BUNDLE / CREATE LOGIC (UPDATED FOR 0 BUY) ---
        async function executeBundle() {
            if(!mainWallet) return log("Connect Wallet first!", "error");
            const fileInput = document.getElementById('tImage');
            if(fileInput.files.length === 0) return log("Upload an image!", "error");

            // Allow 0 for simple creation
            let devBuy = parseFloat(document.getElementById('devBuy').value);
            if(isNaN(devBuy)) devBuy = 0; 

            log("--- UPLOADING METADATA ---", "warn");
            
            const fd = new FormData();
            fd.append("file", fileInput.files[0]);
            fd.append("name", document.getElementById('tName').value);
            fd.append("symbol", document.getElementById('tSymbol').value);
            fd.append("description", document.getElementById('tDesc').value);
            fd.append("twitter", document.getElementById('tTwitter').value || "");
            fd.append("telegram", document.getElementById('tTelegram').value || "");
            fd.append("website", document.getElementById('tWebsite').value || "");
            fd.append("showName", "true");

            try {
                const ipfsRes = await fetch("https://pumpportal.fun/api/ipfs", { method: "POST", body: fd });
                const ipfsData = await ipfsRes.json();
                
                if(!ipfsData.metadataUri) throw new Error("Metadata Upload Failed");
                log("Metadata Uploaded. Constructing Transaction...", "info");

                const response = await fetch('https://pumpportal.fun/api/trade-local', {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        "publicKey": mainWallet.publicKey.toBase58(),
                        "action": "create",
                        "tokenMetadata": {
                            name: ipfsData.metadata.name,
                            symbol: ipfsData.metadata.symbol,
                            uri: ipfsData.metadataUri
                        },
                        "mint": solanaWeb3.Keypair.generate().publicKey.toBase58(),
                        "denominatedInSol": "true",
                        "amount": devBuy, // Can be 0
                        "slippage": 20,
                        "priorityFee": 0.005,
                        "pool": "pump"
                    })
                });

                if(response.ok) {
                    const buf = await response.arrayBuffer();
                    const tx = solanaWeb3.VersionedTransaction.deserialize(new Uint8Array(buf));
                    tx.sign([mainWallet]);
                    const sig = await connection.sendRawTransaction(tx.serialize());
                    
                    if(devBuy === 0) {
                        log(`TOKEN CREATED (No Buy): ${sig}`, "success");
                    } else {
                        log(`BUNDLE DEPLOYED (Buy ${devBuy} SOL): ${sig}`, "success");
                    }
                } else {
                    const err = await response.text();
                    log("API Error: " + err, "error");
                }

            } catch(e) {
                log("Deploy Failed: " + e.message, "error");
            }
        }

        // --- OTHER UTILS ---
        async function cloneCoin() {
            const ca = document.getElementById('cloneCA').value;
            if(!ca) return;
            log("Cloning...", "info");
            try {
                const res = await fetch(`https://corsproxy.io/?https://frontend-api.pump.fun/coins/${ca}`);
                const data = await res.json();
                document.getElementById('tName').value = data.name;
                document.getElementById('tSymbol').value = data.symbol;
                document.getElementById('tDesc').value = data.description;
                if(data.twitter) document.getElementById('tTwitter').value = data.twitter;
                if(data.telegram) document.getElementById('tTelegram').value = data.telegram;
                if(data.website) document.getElementById('tWebsite').value = data.website;
                if(data.image_uri) {
                    const imgRes = await fetch(`https://corsproxy.io/?${data.image_uri}`);
                    const blob = await imgRes.blob();
                    const file = new File([blob], "clone.png", { type: "image/png" });
                    const dt = new DataTransfer(); dt.items.add(file);
                    document.getElementById('tImage').files = dt.files;
                }
                log("Cloned successfully.", "success");
            } catch(e) { log("Clone failed.", "error"); }
        }

        function generateWallets() {
            const count = parseInt(document.getElementById('genCount').value);
            const list = document.getElementById('walletList');
            list.innerHTML = "";
            subWallets = [];
            for(let i=0; i<count; i++) {
                const kp = solanaWeb3.Keypair.generate();
                subWallets.push(kp);
                const pk = kp.publicKey.toBase58();
                const div = document.createElement('div');
                div.className = "flex justify-between border-b border-slate-900 pb-1 hover:bg-slate-900 px-2";
                div.innerHTML = `<span class="text-indigo-400 font-bold">W${i+1}</span><span class="text-slate-500 cursor-pointer" onclick="navigator.clipboard.writeText('${pk}')">${pk.slice(0,6)}...${pk.slice(-6)}</span>`;
                list.appendChild(div);
            }
            log(`Generated ${count} wallets.`, "info");
        }

        async function fundAll() {
            if(!mainWallet) return log("Connect Main Wallet", "error");
            const amount = parseFloat(document.getElementById('fundAmt').value);
            log(`Funding ${subWallets.length} wallets...`, "warn");
            for (let i = 0; i < subWallets.length; i++) {
                try {
                    const tx = new solanaWeb3.Transaction().add(
                        solanaWeb3.SystemProgram.transfer({
                            fromPubkey: mainWallet.publicKey,
                            toPubkey: subWallets[i].publicKey,
                            lamports: Math.floor(amount * 1e9)
                        })
                    );
                    await solanaWeb3.sendAndConfirmTransaction(connection, tx, [mainWallet]);
                    log(`Funded W${i+1}`, "success");
                    await sleep(500);
                } catch(e) { log(`Failed W${i+1}`, "error"); }
            }
        }

        function copyAllKeys() {
            if(subWallets.length===0) return;
            let data = "";
            subWallets.forEach((w,i) => data += `[${i+1}] ${w.publicKey.toBase58()} | ${b58_enc(w.secretKey)}\n`);
            navigator.clipboard.writeText(data).then(()=>log("Keys copied!","success"));
        }

        function exportKeys() {
            if(subWallets.length===0) return;
            let csv = "Index,Public_Key,Private_Key\n";
            subWallets.forEach((w,i) => csv += `${i+1},${w.publicKey.toBase58()},${b58_enc(w.secretKey)}\n`);
            const a = document.createElement('a');
            a.href = URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
            a.download = "wallets.csv";
            a.click();
        }

        async function startSnipe() {
            const ca = document.getElementById('snipeCA').value;
            if(!ca) return log("No CA", "error");
            isSniping = true;
            log(`Monitoring ${ca}...`, "warn");
            const check = setInterval(async () => {
                if(!isSniping) clearInterval(check);
                try {
                    const info = await connection.getAccountInfo(new solanaWeb3.PublicKey(ca));
                    if(info) { clearInterval(check); log("Swarming...", "success"); doSwarm(ca, "buy"); }
                } catch(e) {}
            }, 1000);
        }

        async function doSwarm(mint, action) {
            const amt = parseFloat(document.getElementById('snipeAmt').value);
            const slip = parseFloat(document.getElementById('snipeSlip').value);
            const promises = subWallets.map(async (w, i) => {
                try {
                    const res = await fetch('https://pumpportal.fun/api/trade-local', {
                        method: "POST", headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            "publicKey": w.publicKey.toBase58(), "action": action, "mint": mint,
                            "denominatedInSol": action === 'buy' ? "true" : "false",
                            "amount": action === 'buy' ? amt : "100%",
                            "slippage": slip, "priorityFee": 0.005, "pool": "pump"
                        })
                    });
                    if(res.ok) {
                        const buf = await res.arrayBuffer();
                        const tx = solanaWeb3.VersionedTransaction.deserialize(new Uint8Array(buf));
                        tx.sign([w]);
                        await connection.sendRawTransaction(tx.serialize());
                        log(`W${i+1} ${action} OK`, "success");
                    }
                } catch(e) { log(`W${i+1} Fail`, "error"); }
            });
            await Promise.all(promises);
        }

        function instaSell() { if(confirm("SELL ALL?")) { const ca=document.getElementById('snipeCA').value; if(ca) doSwarm(ca,"sell"); } }
        
        async function returnSol() {
            log("Refunding...", "warn");
            for(let w of subWallets) {
                try {
                    const bal = await connection.getBalance(w.publicKey);
                    if(bal > 5000) {
                        const tx = new solanaWeb3.Transaction().add(
                            solanaWeb3.SystemProgram.transfer({ fromPubkey: w.publicKey, toPubkey: mainWallet.publicKey, lamports: bal - 5000 })
                        );
                        await solanaWeb3.sendAndConfirmTransaction(connection, tx, [w]);
                        log(`Refunded ${w.publicKey.toBase58().slice(0,4)}`, "success");
                    }
                } catch(e) {}
            }
        }
        
        // Auto-init for convenience
        setTimeout(initConnection, 1000);
    </script>
</body>
</html>
